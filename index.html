<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VERA — Your Nervous System Is Finally Speaking</title>
<meta name="description" content="Speak with VERA through a living Neuro Orb. Real-time somatic guidance with voice.">
<style>
  /* ---------- RESET ---------- */
  *,*::before,*::after{box-sizing:border-box}html,body{margin:0;height:100%}
  body{-webkit-font-smoothing:antialiased;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Apple Color Emoji","Segoe UI Emoji";background:#060819;color:#eaf0ff;overflow-x:hidden}

  /* ---------- THE COSMOS ---------- */
  .sky{position:fixed;inset:0;z-index:0;pointer-events:none}
  .star{position:absolute;width:2px;height:2px;border-radius:50%;background:rgba(255,255,255,.6);opacity:.6;filter:drop-shadow(0 0 6px #89a4ff);animation:twinkle 8s linear infinite}
  @keyframes twinkle{0%,100%{opacity:.15;transform:scale(.8)}50%{opacity:.9;transform:scale(1.25)}}
  .filament{position:absolute;width:2px;background:linear-gradient(180deg,transparent,rgba(181,158,241,.65),transparent);transform-origin:center;opacity:.25;animation:fil 12s ease-in-out infinite}
  @keyframes fil{0%,100%{transform:rotate(0deg) scaleY(1)}50%{transform:rotate(180deg) scaleY(1.4)}}

  /* ---------- HEADER ---------- */
  nav{position:fixed;top:0;left:0;right:0;height:64px;display:flex;align-items:center;justify-content:space-between;padding:0 22px;background:linear-gradient(180deg,rgba(6,8,25,.9),rgba(6,8,25,.35));backdrop-filter:blur(10px);z-index:20;border-bottom:1px solid rgba(255,255,255,.06)}
  .brand{letter-spacing:.55em;font-weight:600;font-size:18px;color:#cfe2ff}
  .cta{appearance:none;border:0;border-radius:999px;padding:10px 18px;background:linear-gradient(135deg,#b79df9,#6fb3ff);color:#041026;font-weight:700;cursor:pointer;box-shadow:0 10px 30px rgba(127,159,255,.25);transition:transform .2s}
  .cta:hover{transform:translateY(-2px)}

  /* ---------- HERO ---------- */
  .hero{position:relative;z-index:1;min-height:100vh;display:grid;place-items:center;padding-top:70px}
  .stack{display:grid;gap:18px;text-align:center;max-width:980px;margin:0 auto;padding:0 18px}
  .title{font-size:clamp(32px,6vw,56px);line-height:1.15;font-weight:800;background:linear-gradient(90deg,#cfe2ff,#bca9ff,#79c0ff);-webkit-background-clip:text;background-clip:text;color:transparent}
  .subtitle{color:#adc0ffb0;font-size:clamp(16px,2.5vw,20px)}

  /* ---------- NEURO ORB ---------- */
  .orb-wrap{position:relative;width:min(90vw,560px);aspect-ratio:1/1;margin:36px auto 4px}
  .orb{position:absolute;inset:0;border-radius:50%;background:
      radial-gradient(110% 110% at 30% 30%,rgba(255,200,255,.55) 0%,rgba(164,128,255,.45) 26%,rgba(121,192,255,.35) 52%,rgba(123,89,210,.25) 72%,rgba(0,0,0,0) 100%),
      radial-gradient(60% 60% at 70% 70%,rgba(100,255,220,.15),rgba(0,0,0,0) 60%);
    box-shadow:0 0 120px 40px rgba(129,108,255,.25), inset 0 0 160px rgba(121,192,255,.25);
    border:1px solid rgba(201,182,255,.35);
    animation:floaty 7s ease-in-out infinite}
  @keyframes floaty{0%,100%{transform:translateY(-2px)}50%{transform:translateY(6px)}}
  .halo{position:absolute;inset:-12%;border-radius:50%;filter:blur(60px);background:radial-gradient(circle at 50% 55%,rgba(130,239,255,.08),rgba(115,145,255,.08),rgba(210,148,255,.08),transparent 60%);animation:halo 8s linear infinite}
  @keyframes halo{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

  .orb-btn{position:absolute;inset:0;border-radius:50%;background:transparent;border:0;cursor:pointer}
  .pulse{position:absolute;inset:-8%;border-radius:50%;border:2px solid rgba(168,139,255,.35);animation:pulse 2.2s ease-out infinite;pointer-events:none}
  @keyframes pulse{0%{transform:scale(.85);opacity:.75}100%{transform:scale(1.15);opacity:0}}

  .caption{position:absolute;left:50%;bottom:-56px;transform:translateX(-50%);color:#cfe2ff;opacity:.9;font-size:15px;background:linear-gradient(180deg,rgba(13,18,43,.8),rgba(13,18,43,.6));border:1px solid rgba(255,255,255,.08);padding:10px 14px;border-radius:12px;backdrop-filter:blur(8px);max-width:min(86vw,640px)}
  .chip-row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px}
  .chip{font-size:13px;color:#dfe7ff;opacity:.9;border:1px solid rgba(255,255,255,.12);background:linear-gradient(135deg,rgba(167,146,255,.15),rgba(121,192,255,.12));border-radius:999px;padding:8px 12px;cursor:pointer}
  .chip:hover{border-color:rgba(214,196,255,.45)}

  /* ---------- HINT INPUT (fallback when mic unsupported) ---------- */
  .inline{margin:12px auto 0;display:none;gap:8px;max-width:680px}
  .inline input{flex:1;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:#eaf0ff;border-radius:999px;padding:12px 14px}
  .inline button{border-radius:999px;border:0;padding:12px 16px;background:#89a4ff;color:#041026;font-weight:700}

  /* ---------- INFO / FOOTER ---------- */
  .section{padding:70px 18px 90px;max-width:1100px;margin:0 auto}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
  .card{background:linear-gradient(135deg,rgba(13,18,43,.85),rgba(9,12,33,.85));border:1px solid rgba(255,255,255,.08);padding:22px;border-radius:16px}
  .card h3{margin:0 0 8px;color:#cfe2ff}
  .muted{color:#adc0ffb0}

  footer{padding:50px 18px;color:#8ca6ff7a;text-align:center}
</style>
</head>
<body>
  <!-- STARFIELD / FASCIA -->
  <div class="sky" id="sky"></div>

  <!-- HEADER -->
  <nav>
    <div class="brand">V&nbsp;E&nbsp;R&nbsp;A</div>
    <button class="cta" onclick="document.getElementById('learn').scrollIntoView({behavior:'smooth'})">Experience VERA</button>
  </nav>

  <!-- HERO + ORB -->
  <main class="hero">
    <div class="stack">
      <h1 class="title">Your Nervous System Is Finally Speaking</h1>
      <p class="subtitle">Press the Orb. VERA will greet you and speak. Ask anything you feel in your body — <em>she’ll respond somatically</em>.</p>

      <div class="orb-wrap">
        <div class="halo"></div>
        <div class="orb" id="orb"></div>
        <div class="pulse" id="pulse" style="display:none"></div>
        <button class="orb-btn" id="orbBtn" aria-label="Talk to VERA"></button>

        <div class="caption" id="caption">Tap the orb to begin. You can talk or type (mic permitting).<div class="chip-row">
          <div class="chip" onclick="guide('breath')">Guide my breath</div>
          <div class="chip" onclick="guide('sway')">Help me sway</div>
          <div class="chip" onclick="guide('ground')">Ground me now</div>
        </div></div>
      </div>

      <div class="inline" id="typeRow">
        <input id="typeBox" placeholder="No mic? Type what your body is saying…" />
        <button onclick="typed()">Send</button>
      </div>
    </div>
  </main>

  <!-- INFO CARDS -->
  <section class="section" id="learn">
    <div class="grid">
      <div class="card">
        <h3>Somatic, not semantic</h3>
        <p class="muted">VERA reflects sensations — tight, warm, buzzy, numb — and gives micro-moves that shift patterns fast.</p>
      </div>
      <div class="card">
        <h3>Voice by ElevenLabs</h3>
        <p class="muted">All replies are spoken via <code>/api/vera-voice</code>. If it fails, the site falls back to the browser’s voice.</p>
      </div>
      <div class="card">
        <h3>Neural presence</h3>
        <p class="muted">The living neuron field pulses with you. The Orb expands as VERA “breathes”.</p>
      </div>
      <div class="card">
        <h3>Private & local</h3>
        <p class="muted">This demo keeps everything on-device — no chat logs, just instant guidance.</p>
      </div>
    </div>
  </section>

  <footer>© 2024 VERA • Where souls remember safety</footer>

  <!-- HIDDEN AUDIO FOR TTS -->
  <audio id="veraAudio" preload="auto"></audio>

<script>
/* ===========================
   LIVING SKY (STARS + FASCIA)
=========================== */
(function makeSky(){
  const sky = document.getElementById('sky');
  const W = innerWidth, H = innerHeight;

  // Stars
  for(let i=0;i<240;i++){
    const s = document.createElement('div');
    s.className = 'star';
    s.style.left = Math.random()*W+'px';
    s.style.top = Math.random()*H+'px';
    s.style.animationDelay = (Math.random()*8)+'s';
    s.style.transform = `scale(${.5 + Math.random()*1.2})`;
    sky.appendChild(s);
  }
  // Fascia filaments
  for(let i=0;i<90;i++){
    const f = document.createElement('div');
    f.className = 'filament';
    f.style.height = (60 + Math.random()*300) + 'px';
    f.style.left = Math.random()*W+'px';
    f.style.top = Math.random()*H+'px';
    f.style.animationDelay = (Math.random()*10)+'s';
    f.style.transform = `rotate(${Math.random()*360}deg)`;
    sky.appendChild(f);
  }
})();

/* ===========================
   ORB INTERACTION + VOICE
=========================== */
const orbBtn   = document.getElementById('orbBtn');
const orb      = document.getElementById('orb');
const pulse    = document.getElementById('pulse');
const caption  = document.getElementById('caption');
const audioEl  = document.getElementById('veraAudio');
const typeRow  = document.getElementById('typeRow');
const typeBox  = document.getElementById('typeBox');

let hasGreeted = false;
let listening  = false;
let recognizer = null;

function setCaption(text){
  caption.firstChild.nodeValue = text;
}

function pulseOn(on){
  pulse.style.display = on ? 'block' : 'none';
}

/* Speak via ElevenLabs proxy; fallback to SpeechSynthesis */
async function veraSpeak(text){
  try{
    const r = await fetch('/api/vera-voice', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ text })
    });
    if(!r.ok) throw new Error('TTS proxy failed');
    const blob = await r.blob();
    const url  = URL.createObjectURL(blob);
    audioEl.src = url;
    await audioEl.play().catch(()=>{});
    setTimeout(()=>URL.revokeObjectURL(url), 12000);
  }catch(e){
    if('speechSynthesis' in window){
      const u = new SpeechSynthesisUtterance(text);
      u.rate=.95; u.pitch=1.05;
      window.speechSynthesis.speak(u);
    }
  }
}

/* Simple somatic brain */
function replyFor(input){
  const s = (input||'').toLowerCase();
  const M = {
    anxious: "I feel your system running fast. Press your feet into the floor for two breaths. Notice if the current drops even 5%.",
    tight:   "Let the tight place move one millimeter, then another. You don’t have to open — just allow a ripple.",
    chest:   "Soften the sternum one grain of rice. Let your breath fill the back of your ribs.",
    heart:   "Let the heart be held by the spine. Imagine hammock strings behind the chest.",
    relax:   "Clench both hands for two seconds… and melt them open. That difference is what we’ll train.",
    safe:    "Look around and name three colors you see. Your midbrain records safety through evidence.",
    fear:    "Beautiful. Fear is wisdom at the door. We’ll move slow. Breathe low into the belly, like pouring sand.",
  };
  for(const k of Object.keys(M)){ if(s.includes(k)) return M[k]; }
  return "Tell me where the strongest sensation lives — front/back, left/right, surface/deep. Give it three words for texture.";
}

function greet(){
  hasGreeted = true;
  setCaption("Hi. I'm here. Describe what your body feels — or press and speak.");
  veraSpeak("Hi. I'm here. Tell me what your body is feeling right now.");
}

/* Guide chips */
function guide(kind){
  let text="";
  if(kind==='breath'){
    text="Let’s breathe together. Inhale softly for four… hold for four… exhale for six. We’ll repeat three times. Feel your rib cage widen in the back.";
  }else if(kind==='sway'){
    text="Stand or sit and let your spine sway like kelp in warm water. Tiny waves. No forcing, just allowing.";
  }else{
    text="We’ll ground now. Name five things you see. Four you can touch. Three you hear. Two you smell. One you taste. I’m here with you.";
  }
  setCaption(text);
  veraSpeak(text);
}

/* Mic recognition (Chrome/Edge). Fallback shows typing row. */
function initRecognizer(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ typeRow.style.display='grid'; return null; }
  const r = new SR();
  r.lang = 'en-US'; r.continuous = false; r.interimResults = false; r.maxAlternatives = 1;
  r.onstart = ()=>{ listening = true; pulseOn(true); setCaption("Listening… share what your body is feeling."); };
  r.onend   = ()=>{ listening = false; pulseOn(false); };
  r.onerror = ()=>{ listening = false; pulseOn(false); typeRow.style.display='grid'; setCaption("Mic unavailable. You can type below."); };
  r.onresult= (e)=>{
    const text = e.results[0][0].transcript || "";
    if(text.trim().length) processInput(text);
  };
  return r;
}
recognizer = initRecognizer();

/* Main orb click */
orbBtn.addEventListener('click', ()=>{
  if(!hasGreeted){ greet(); return; }
  if(recognizer && !listening){
    try{ recognizer.start(); }catch{}
  }else{
    typeRow.style.display='grid';
    typeBox.focus();
  }
});

/* Typed fallback */
function typed(){
  const v = typeBox.value.trim();
  if(!v) return;
  typeBox.value="";
  processInput(v);
}

/* Process, speak, animate */
function processInput(text){
  const r = replyFor(text);
  setCaption(r + "  (You said: “" + text + "”.)");
  orb.style.animation = 'none'; // bump
  setTimeout(()=>{ orb.style.animation='floaty 7s ease-in-out infinite'; }, 50);
  veraSpeak(r);
}

/* Audio pulses toggle mic pulse only while speaking */
audioEl.addEventListener('play', ()=>pulseOn(true));
audioEl.addEventListener('ended', ()=>{ if(!listening) pulseOn(false); });

/* Initial hint */
setCaption("Tap the orb to begin. You can talk or type (mic permitting).");
</script>
</body>
</html>
